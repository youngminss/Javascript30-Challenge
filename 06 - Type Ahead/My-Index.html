<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Type Ahead ğŸ‘€</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <form class="search-form">
        <input type="text" class="search" placeholder="City or State">
        <ul class="suggestions">
            <li>Filter for a city</li>
            <li>or a state</li>
        </ul>
    </form>

<script>
    const endpoint = 'https://gist.githubusercontent.com/Miserlou/c5cd8364bf9b2420bb29/raw/2bf258763cdddd704f8ffd3ea9a3e81d25e2c6f6/cities.json';
    
    const cities = [];
    fetch(endpoint)
        .then(res => res.json())
        .then(data => cities.push(...data));
    
    function findMatches(wordToMatch, cities) {
        return cities.filter(place => {
            // RegExp ë¥¼ í†µí•œ, í•„í„°ë§
            // ì‚¬ìš©ìì˜ ì…ë ¥ì˜ ë”°ë¥¸ regex ì²˜ë¦¬ê°€ í•„ìš”í•  ë•Œ, ì´ë ‡ê²Œ ì¸ìŠ¤í„´ìŠ¤ í˜•íƒœë¡œ ì‚¬ìš©í•˜ë¼ê³  í•œë‹¤.
            // g = ì „ì²´, i = ëŒ€ì†Œë¬¸ì êµ¬ë¶„ X
            // match() ëŠ” regex ì™€ ë³´í†µ ê°™ì´ ì“´ë‹¤. regex ì— í•´ë‹¹í•˜ëŠ” ê²ƒë“¤ì„ ì°¾ì•„ ë°°ì—´í˜•íƒœë¡œ ë°˜í™˜, ì—†ìœ¼ë©´ null
            // ê° place ì˜ city ë˜ëŠ” state ì—, í•´ë‹¹ wordToMatch ê²€ìƒ‰ì—´ì— í•´ë‹¹í•˜ëŠ” ë¶€ë¶„ì´ í•œ ê³³ì´ë¼ë„ ìˆë‹¤ë©´, true ë°˜í™˜í•˜ë¯€ë¡œì¨, filter ì— í•´ë‹¹ place ê°€ ê±¸ëŸ¬ì§
            const regex = new RegExp(wordToMatch, 'gi');
            return place.city.match(regex) || place.state.match(regex)
        });
    }

    function numberWithCommas(x) {
        // ìˆ«ì ì²´ê³„ ,(ì½¤ë§ˆ) ìƒì„± regex
        // replace ë„ ë˜í•œ, regex ì™€ ê°™ì´ ì˜ ì“°ì¸ë‹¤.
        return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',');
    }

    function displayMatches() {
        // ì—¬ê¸°ì„œ thisëŠ” í˜¸ì¶œí•œ searchInput ìš”ì†Œì´ë‹¤.
        const matchArray = findMatches(this.value, cities);
        const html = matchArray.map(place => {
            // ë‚´ê°€ ê´œíˆ ë©€ë¦¬ ë´¤ë‹¤.
            // city ì™€ state ë¥¼ ë”°ë¡œ ë‘ë©´, replace ë¥¼ ì¨ì„œ, regexë¥¼ í†µí•´ ì‰½ê²Œ í•˜ì´ë¼ì´íŒ…ì´ í•„ìš”í•œ ë¶€ë¶„ì„ ë°”ê¿€ ìˆ˜ ìˆë‹¤.
            const regex = new RegExp(this.value, 'gi');
            const cityName = place.city.replace(regex, `<span class="hl">${this.value}</span>`);
            const stateName = place.state.replace(regex, `<span class="hl">${this.value}</span>`);
            return `
                <li>
                    <span class="name">${cityName}, ${stateName}</span>
                    <span class="population">${numberWithCommas(place.population)}</span>
                </li>
            `;
        }).join('');
        // ë§ˆì§€ë§‰ì—, ì„ íƒëœ place ë“¤ì€ íƒœê·¸ stringì˜ ë°°ì—´í˜•íƒœë‹ˆê¹, í•˜ë‚˜ë¡œ join í•˜ëŠ” ê³¼ì • í•„ìš”
        suggestions.innerHTML = html;
    }

    const searchInput = document.querySelector('.search');
    const suggestions = document.querySelector('.suggestions');

    searchInput.addEventListener('change', displayMatches);
    searchInput.addEventListener('keyup', displayMatches);
    
    // < ì´ˆê¸° ë‚´ ì½”ë“œ = í•˜ì´ë¼ì´íŒ… í•˜ëŠ” ê³¼ì •ì—ì„œ ë§‰í˜ >
    // const ul = document.querySelector('.suggestions');
    // const input = document.querySelector('.search');

    // function fetchPromise() {
    //     return new Promise((resolve, reject) => {
    //         fetch(endpoint)
    //         .then(res => res.json())
    //         .then(data => resolve(data));
    //     })
    // }

    // async function fetchData() {
    //     const result = await fetchPromise();
    //     return result;
    // }
    
    // function makeAllList(newDataArr) {
    //     let listAll = ''
    //     newDataArr.forEach((data) => listAll += 
    //     `<li>
    //         <span class="nsame">${data.name}</span>
    //         <span class="population">${data.population}</span>
    //     </li>`);
    //     ul.innerHTML = listAll;
    // }

    // function makefilterList(newDataArr, target) {
        
    //     let filterDataArr = newDataArr.filter((data) => data.name.toLowerCase().includes(target.toLowerCase()) ? true : false);
    //     let listAll = '';
        
    //     filterDataArr.forEach((data) => {
    //         listAll +=
    //             `<li>
    //                 <span class="name">
    //                  ${data.name.slice(0,data.name.indexOf(target))}<span class="hl">${data.name.slice(data.name.indexOf(target), ((data.name.indexOf(target) + target.length)))}</span>${data.name.slice((data.name.indexOf(target) + target.length),data.name.length)}
    //                 </span>
    //             <span class="population">${data.population}</span>
    //             </li>`
    //      });
    //     ul.innerHTML = listAll;
    // }

    // function filterResult(e) {
    //     fetchData()
    //     .then(res => {
    //         let newData = res.map((el) => {
    //             var newObj = {};
    //             newObj['name'] = `${el.city}, ${el.state}`;
    //             newObj['population'] = el.population.replace(/(\d)(?=(?:\d{3})+(?!\d))/g, '$1,');
    //             return newObj;
    //         })
    //         e.target.value === '' ? makeAllList(newData) : makefilterList(newData,e.target.value);
    //     });
    // }
    
    // input.addEventListener('input',filterResult);
</script>
</body>
</html>